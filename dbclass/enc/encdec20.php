<?php $flag_fail=1;$del_enc='_';function col_new($num){$num=range(1,$num);shuffle($num);return $num;}function encrypt($main_pass){global $flag_fail;global $del_enc;$dic=array("a","d","e","w","1","9","y","+","z");$res=NULL;if (!isset($main_pass)){if($flag_fail==0)return false;else if($flag_fail==1){$pw_built=array("string_enc"=>"??????","pw_status"=>"Error:encrypt(); No ingresaste la palabra a encriptar.");return $pw_built;}}$cnt_pass=strlen($main_pass);$ndic=count($dic);if ($ndic==FALSE||$ndic==NULL||$ndic==0){echo "<center><b>Error Grave, diccionario no fu&eacute;e inclu&iacute;do. encrypt();</b></center>";exit();}$cnt_pass=strlen($main_pass);$azar=col_new($ndic+$cnt_pass);for($i=0;$i<$ndic+$cnt_pass;$i++)$cont[]=$dic[rand(0,$ndic-1)];for($pass=0;$pass<$cnt_pass;$pass++){$ssap_w=substr($main_pass,-1-$pass,1);$cont[$azar[$pass]]=$ssap_w;$indice[]=$azar[$pass];}$words=implode("",$cont);$words=base64_encode($words);$cnt_words=strlen($words);$cnt_ind=count($indice);for($i=0;$i<$cnt_ind;$i++)$res=$res.dechex($indice[$i]+$ndic).$del_enc.dechex(rand(10,11)); $b64encind_ori=base64_encode($res);for($i=0;$i<strlen($b64encind_ori);$i++)$shuff_ind[]=$b64encind_ori[$i];shuffle($shuff_ind);$shuff_ind=implode("",$shuff_ind);$ncoded=$words.$shuff_ind;$w_del=strlen($words);$encoded=array("encoded"=>$ncoded,"password"=>$b64encind_ori,"w_del"=>$w_del);unset($cont,$ncoded,$w_del,$indice,$shuff_ind,$b64encind_ori,$res,$cnt_ind,$main_pass,$ssap_w,$string,$azar,$ndic,$cnt_pass);return $encoded;}function decrypt($string,$key,$w_del){$dic=array("a","d","e","w","1","9","y","+","z");global $flag_fail;global $keyw;global $del_enc;if(!isset($string)||!isset($key)||!isset($w_del)){if ($flag_fail==0)return false;else if ($flag_fail==1){$pw_dec=array("string_enc"=>$string,"pw_status"=>"BAD:decrypt(); Null or blank key","key_ori"=>$key,"key_enc"=>"null","decrypted"=>"Yuck");return $pw_dec;}}$key_ori=$key;$cnt_pass=strlen($string);$ndic=count($dic);if ($ndic==FALSE||$ndic==NULL||$ndic==0){echo "<center><b>Error Grave, diccionario no fu&eacute;e inclu&iacute;do. decrypt();</b></center>";exit();}$s_key=substr($string,$w_del);$cnt_key=strlen($key);$cnt_skey=strlen($s_key);for($i=0;$i<$cnt_key;$i++){for($j=0;$j<$cnt_skey;$j++){switch($key[$i]): case($s_key[$j]):$match[]=$key[$i];$j=$cnt_skey;break;endswitch;}}$cnt_match=count($match);if((count($match)!=$cnt_key)||(count($match)!=$cnt_skey)){if ($flag_fail==0)return false;else if ($flag_fail==1){$pw_dec=array("string_enc"=>$string,"pw_status"=>"BAD:decrypt(); password mismatch, sorry.","key_ori"=>$key,"key_gen"=>$s_key,"decrypted"=>"Yuck");return $pw_dec;}}if(strstr("=".$s_key,$key)==TRUE){if($flag_fail==0)return false;else if ($flag_fail==1){$pw_dec=array("string_enc"=>$string,"pw_status"=>"BAD:decrypt(); password mismatch, sorry.","key_ori"=>$key,"key_gen"=>$s_key,"decrypted"=>"Yuck");return $pw_dec;}}$b64decind=base64_decode($key);$totchar=strlen($b64decind);for($i=0;$i<$totchar;$i++){$ind=substr($b64decind,$i,strlen($del_enc));$chword=substr($b64decind,$i,1);switch($ind):case($del_enc):$cont[]=$keyw;$keyw="";break;endswitch;$keyw.=$chword;$keyw=str_replace($del_enc.$chword,"",$keyw);}for($i=0;$i<count($cont);$i++){$ind=hexdec($cont[$i]);$i_dec[]=$ind-$ndic;}$cnt_string_wrd=strlen($string)-strlen($key_ori);$string_sinpw=substr($string,0,$cnt_string_wrd);$string_enc=base64_decode($string_sinpw);for($i=0;$i<count($i_dec);$i++){$w=substr($string_enc,$i_dec[$i],1);$pw_built[1-$i]=$w;}ksort($pw_built);$pw_built=implode("",$pw_built);$pw_dec=array("string_enc"=>$string,"pw_status"=>"OK","key_ori"=>$key,"decrypted"=>$pw_built);unset($key,$b64decind,$totchar,$i,$ind,$chword,$cont,$keyw,$key_ori,$i_dec,$string_sinpw,$string,$string_enc,$pw_built);return $pw_dec;}?>